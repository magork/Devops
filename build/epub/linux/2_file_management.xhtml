<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>2. File management</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/epub.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/max_width.css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="file-management">
<h1>2. File management</h1>
<section id="linux-directory-tree">
<h2>Linux directory tree</h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>linux_user@linux_machine<span class="w"> </span>~<span class="o">]</span>$<span class="w"> </span>tree<span class="w"> </span>-d<span class="w"> </span>-L<span class="w"> </span><span class="m">2</span><span class="w"> </span>/

/<span class="w">                 </span><span class="c1"># root file system</span>
├──<span class="w"> </span>bin<span class="w">           </span><span class="c1"># user executable commands</span>
├──<span class="w"> </span>boot<span class="w">          </span><span class="c1"># kernel, boot configuration files</span>
├──<span class="w"> </span>dev<span class="w">           </span><span class="c1"># (V) device nodes for physical hardware and virtual devices</span>
├──<span class="w"> </span>etc<span class="w">           </span><span class="c1"># system configuration files</span>
├──<span class="w"> </span>home<span class="w">          </span><span class="c1"># user home directories</span>
├──<span class="w"> </span>opt<span class="w">           </span><span class="c1"># additional software</span>
├──<span class="w"> </span>proc<span class="w">          </span><span class="c1"># (V) current state of the running kernel</span>
├──<span class="w"> </span>root<span class="w">          </span><span class="c1"># home directory for the root user</span>
├──<span class="w"> </span>sbin<span class="w">          </span><span class="c1"># system administration commands</span>
├──<span class="w"> </span>sys<span class="w">           </span><span class="c1"># (V) info about hotplug hardware devices</span>
├──<span class="w"> </span>tmp<span class="w">           </span><span class="c1"># temporary files, usually automatically deleted at reboot</span>
├──<span class="w"> </span>usr<span class="w">           </span><span class="c1"># system resources files</span>
│<span class="w">   </span>├──<span class="w"> </span>lib<span class="w">       </span><span class="c1"># shared libraries used by commands, kernel, programs</span>
│<span class="w">   </span>├──<span class="w"> </span>lib64<span class="w">     </span><span class="c1"># shared libraries used by commands, kernel, programs</span>
│<span class="w">   </span>├──<span class="w"> </span>libexec<span class="w">   </span><span class="c1"># binaries run by other programs</span>
│<span class="w">   </span>├──<span class="w"> </span><span class="nb">local</span><span class="w">     </span><span class="c1"># custom commands, libraries, programs</span>
│<span class="w">   </span>├──<span class="w"> </span>share<span class="w">     </span><span class="c1"># man pages, documentation, sample configuration files</span>
│<span class="w">   </span>└──<span class="w"> </span>src<span class="w">       </span><span class="c1"># source code</span>
└──<span class="w"> </span>var<span class="w">           </span><span class="c1"># data that changes frequently</span>
<span class="w">        </span>├──<span class="w"> </span>lock<span class="w">      </span><span class="c1"># lock files for devices and other resources shared by multiple applications</span>
<span class="w">        </span>├──<span class="w"> </span>log<span class="w">       </span><span class="c1"># system log files</span>
<span class="w">        </span>├──<span class="w"> </span>run<span class="w">       </span><span class="c1"># information about the system that is valid until the system is next booted</span>
<span class="w">        </span>├──<span class="w"> </span>spool<span class="w">     </span><span class="c1"># cron jobs, mail messages, print jobs</span>
<span class="w">        </span>└──<span class="w"> </span>tmp<span class="w">       </span><span class="c1"># temporary files, are not deleted automatically</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>sudo rm -rf / ; don’t try this at ~</p>
</div>
</section>
<section id="file-and-directory-permissions">
<h2>File and Directory Permissions</h2>
<p>Linux is a multi-user operating system that allows hundreds of users to log in and work concurrently.</p>
<p>System administrators can grant user access to files and directories, with appropriate rights that allow them to do their job whilst enforcing system security.</p>
<section id="permission-classes">
<h3>Permission Classes</h3>
<blockquote>
<div><ul class="simple">
<li><p><strong>User (u)</strong>: The owner of a file/directory</p></li>
<li><p><strong>Group (g)</strong>: The members of the file/directory’s group</p></li>
<li><p><strong>Others (o)</strong>: Any users that are not part of the <em>user</em> or <em>group</em> classes</p></li>
</ul>
</div></blockquote>
</section>
<section id="permission-types">
<h3>Permission Types</h3>
<blockquote>
<div><ul class="simple">
<li><p><strong>Read (r/4)</strong>: view/copy file/directory contents</p></li>
<li><p><strong>Write (w/2)</strong>: view/copy/move/delete file/directory</p></li>
<li><p><strong>Execute (x/1)</strong>: execute file, access directory</p></li>
</ul>
</div></blockquote>
</section>
<section id="access-permissions">
<h3>Access Permissions</h3>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Octal</p></th>
<th class="head"><p>Symbolic</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>—</p></td>
<td><p>no permissions</p></td>
</tr>
<tr class="row-odd"><td><p>1</p></td>
<td><p>–x</p></td>
<td><p>execute only</p></td>
</tr>
<tr class="row-even"><td><p>2</p></td>
<td><p>-w-</p></td>
<td><p>write only</p></td>
</tr>
<tr class="row-odd"><td><p>3</p></td>
<td><p>-wx</p></td>
<td><p>write and execute</p></td>
</tr>
<tr class="row-even"><td><p>4</p></td>
<td><p>r–</p></td>
<td><p>read only</p></td>
</tr>
<tr class="row-odd"><td><p>5</p></td>
<td><p>r-x</p></td>
<td><p>read and execute</p></td>
</tr>
<tr class="row-even"><td><p>6</p></td>
<td><p>rw-</p></td>
<td><p>read and write</p></td>
</tr>
<tr class="row-odd"><td><p>7</p></td>
<td><p>rwx</p></td>
<td><p>read, write and execute</p></td>
</tr>
</tbody>
</table>
</section>
<section id="access-rights-commands">
<h3>Access rights commands</h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># The chown (change owner) command alters the user that a file or directory belongs to</span>
chown<span class="w"> </span>--help

<span class="c1"># The chgrp (change group) command alters the group that a file or directory belongs to</span>
chgrp<span class="w"> </span>--help

<span class="c1"># The chmod (change mode) command alters the file permissions</span>
chmod<span class="w"> </span>--help

chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span>file

chmod<span class="w"> </span><span class="nv">u</span><span class="o">=</span>rwx<span class="w"> </span>file
</pre></div>
</div>
</section>
<section id="special-permissions">
<h3>Special permissions</h3>
<p>Linux offers three other types of permissions, called <strong>special permission bits</strong> that may be set on executable files or directories to allow them to respond differently for certain operations.</p>
<ul class="simple">
<li><p><strong>setuid</strong> bit: affects only on files, provides non-owners the ability to run executables with the privileges of the owner</p></li>
<li><p><strong>setgit</strong> bit: has an effect on files and directories, used for group collaboration (alters the standard behavior so that the group of the files created inside the directory, will not be that of the user who created them, but that of the parent directory)</p></li>
<li><p><strong>sticky</strong> bit: set on directories with effect on its files, all the files in the directory will be modifiable only by their owners. A typical case is the <em>/tmp</em> directory. Typically, this directory is writable by all users on the system, but a user cannot delete files owned by other users</p></li>
</ul>
</section>
<section id="default-permissions">
<h3>Default permissions</h3>
<p>Linux assigns default permissions to a file or directory at the time of its creation. Default permissions are calculated based on the <strong>umask</strong> (user mask) value subtracted from a preset value called <em>initial permissions</em> (777 for directories, 666 for files).</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"></th>
<th class="head"></th>
<th class="head"></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>initial permissions</p></td>
<td><p>777 -</p></td>
<td><p>666 -</p></td>
</tr>
<tr class="row-odd"><td><p>umask</p></td>
<td><p>022</p></td>
<td><p>022</p></td>
</tr>
<tr class="row-even"><td><p>default permissions</p></td>
<td><p>775</p></td>
<td><p>644</p></td>
</tr>
</tbody>
</table>
</section>
<section id="control-attributes">
<h3>Control attributes</h3>
<p>There are certain <strong>attributes</strong> that may be set on a file or directory in order to control what can or cannot be done to it. For example, you can enable attributes on a file or directory so that no users, including root, can delete, modify, rename, or compress it.</p>
<p>The commands to list or change attributes are <strong>lsattr</strong> and <strong>chattr</strong>.</p>
</section>
<section id="inodes-soft-links-hard-links">
<h3>Inodes, soft links, hard links</h3>
<p>Each file within a file system has associated metadata information such as file’s type, size, permissions, owner’s name, owner’s group name, last access/modification time, ACL settings, link count, number of allocated blocks, and pointers to the location in the file system where the file data is actually stored.</p>
<p>That metadata is stored in a 128 byte space on disk which is called <strong>inode</strong> (index node).</p>
<p>The inode is assigned a unique numeric identifier that is used by the kernel for accessing, tracking, and managing the file.</p>
<p>The inode does not store the file’s name in its metadata. The file name and corresponding inode number mapping is maintained in the directory’s metadata.</p>
<p>A <strong>soft link</strong> (a.k.a. a symbolic link or a symlink) associates one file with another (similar to a shortcut in Windows). Each soft link has a unique inode number that stores the path to the file it is linked with.</p>
<p>A <strong>hard link</strong> associates one or more files with a single inode number, making all files indistinguishable from one another. This implies that the files will have identical permissions, ownership, time stamp, and file contents. Changes made to any of the files will be reflected in the other linked files as well.</p>
</section>
<section id="useful-commands">
<h3>Useful commands</h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>df<span class="w"> </span>-h<span class="w">         </span><span class="c1"># shows information about file system disk usage</span>

du<span class="w"> </span>-h<span class="w"> </span>/var<span class="w">    </span><span class="c1"># shows information about directory and file sizes on disk</span>

du<span class="w"> </span>-h<span class="w"> </span>--max-depth<span class="o">=</span><span class="m">1</span><span class="w"> </span>/usr<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-rh

<span class="w">                        </span><span class="c1"># shows information about directory and file sizes on disk</span>

<span class="w">                        </span><span class="c1"># only on the first level of directories</span>

<span class="w">                        </span><span class="c1"># sort output in reversed order and human-readable format</span>

find<span class="w"> </span>/usr<span class="w"> </span>-type<span class="w"> </span>d

<span class="w">                        </span><span class="c1"># find and print all directories in /usr</span>

find<span class="w"> </span>/var/log<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-name<span class="w"> </span><span class="s2">&quot;*.log&quot;</span>

<span class="w">                        </span><span class="c1"># find and print all files with .log extension in /var/log</span>

find<span class="w"> </span>/<span class="w"> </span>-user<span class="w"> </span>alice

<span class="w">                        </span><span class="c1"># find directories and files owned by Alice</span>

find<span class="w"> </span>/<span class="w"> </span>-group<span class="w"> </span>billing

<span class="w">                        </span><span class="c1"># find directories and files owned by the billing group</span>

find<span class="w"> </span>/<span class="w"> </span>-type<span class="w"> </span>f<span class="w"> </span>-size<span class="w"> </span>+10M<span class="w"> </span>-exec<span class="w"> </span>ls<span class="w"> </span>-lh<span class="w"> </span><span class="o">{}</span><span class="w"> </span><span class="se">\;</span>

<span class="w">                        </span><span class="c1"># find files larger than 10MB and list them in long format</span>
</pre></div>
</div>
</section>
</section>
<section id="todo">
<h2>TODO</h2>
<ul class="simple">
<li><p>create <strong>/opt/billing</strong> directory</p></li>
<li><p>create <strong>/opt/billing/clients</strong> and <strong>/opt/billing/invoices</strong> files</p></li>
<li><p>configure <strong>alice</strong> user as owner for <strong>/opt/billing</strong> directory and its contents</p></li>
<li><p>configure <strong>billing</strong> group as owner for <strong>/opt/billing</strong> directory and its contents</p></li>
<li><dl class="simple">
<dt>configure access rights for <strong>/opt/billing</strong> directory:</dt><dd><ul>
<li><p>read, write and execute for <strong>alice</strong> user</p></li>
<li><p>read and execute for <strong>billing</strong> group</p></li>
<li><p>read and execute for everyone else</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>remove access rights to others for all files in the <strong>/opt/billing</strong> directory</p></li>
<li><p>add write permissions on <strong>/opt/billing/invoices</strong> for <strong>billing</strong> group</p></li>
<li><p>make <strong>john</strong> as owner for <strong>/opt/billing/clients</strong> and assign him read-only rights</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>To err is human … to really f*ck up requires the root password.</p>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>